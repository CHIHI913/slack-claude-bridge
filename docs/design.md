# Slack Ã— Claude Code é€£æº è¨­è¨ˆæ›¸

## 1. å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Slack       â”‚
â”‚ (ç‰¹å®šãƒãƒ£ãƒ³ãƒãƒ«)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ WebSocket (Socket Mode)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Bridge (Node.js)          â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Slack Bot   â”‚  â”‚ Session      â”‚  â”‚
â”‚  â”‚ Client      â”‚  â”‚ Manager      â”‚  â”‚
â”‚  â”‚             â”‚  â”‚              â”‚  â”‚
â”‚  â”‚ - å—ä¿¡      â”‚  â”‚ - JSONèª­æ›¸   â”‚  â”‚
â”‚  â”‚ - æŠ•ç¨¿      â”‚  â”‚ - å¯¾å¿œè¡¨ç®¡ç† â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                â”‚          â”‚
â”‚         â–¼                â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚      Claude Executor        â”‚    â”‚
â”‚  â”‚                             â”‚    â”‚
â”‚  â”‚  - claude -p "..." å®Ÿè¡Œ     â”‚    â”‚
â”‚  â”‚  - --resume ã§å†é–‹          â”‚    â”‚
â”‚  â”‚  - session_id æŠ½å‡º          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ spawn / exec
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Claude Code    â”‚
â”‚  (CLI)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### 2.1 Slack Bot Client

**è²¬å‹™**: Slackã‚¤ãƒ™ãƒ³ãƒˆã®å—ä¿¡ã¨æŠ•ç¨¿

**ä½¿ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: `@slack/bolt` (Socket Modeå¯¾å¿œ)

**ä¸»è¦æ©Ÿèƒ½**:
- Socket Mode ã§ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡
- `message` ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- ã‚¹ãƒ¬ãƒƒãƒ‰ã¸ã®è¿”ä¿¡æŠ•ç¨¿

### 2.2 Session Manager

**è²¬å‹™**: thread_ts â†” session_id ã®å¯¾å¿œç®¡ç†

**ä¸»è¦æ©Ÿèƒ½**:
- å¯¾å¿œè¡¨ã®èª­ã¿è¾¼ã¿ãƒ»ä¿å­˜ï¼ˆJSONï¼‰
- session_id ã®ç™»éŒ²ãƒ»å–å¾—
- å¤ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### 2.3 Claude Executor

**è²¬å‹™**: Claude Code CLI ã®å®Ÿè¡Œ

**ä¸»è¦æ©Ÿèƒ½**:
- æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹: `claude -p "..." --output-format json`
- ã‚»ãƒƒã‚·ãƒ§ãƒ³å†é–‹: `claude -p "..." --resume <session_id> --output-format json`
- session_id ã®æŠ½å‡º
- çµæœãƒ†ã‚­ã‚¹ãƒˆã®æŠ½å‡º

## 3. ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### 3.1 ã‚»ãƒƒã‚·ãƒ§ãƒ³å¯¾å¿œè¡¨ (sessions.json)

```json
{
  "sessions": {
    "<thread_ts>": {
      "session_id": "<claude_session_id>",
      "channel_id": "<channel_id>",
      "created_at": "2026-01-26T10:00:00.000Z",
      "last_used_at": "2026-01-26T10:30:00.000Z"
    }
  }
}
```

### 3.2 Claude Code å‡ºåŠ› (--output-format json)

```json
{
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "result": "ç”Ÿæˆã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ...",
  "usage": {
    "input_tokens": 100,
    "output_tokens": 200
  }
}
```

## 4. å‡¦ç†ãƒ•ãƒ­ãƒ¼

### 4.1 æ–°è¦ã‚¹ãƒ¬ãƒƒãƒ‰ï¼ˆè¦ªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰

```
1. Slack message ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡
2. ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
   - å¯¾è±¡ãƒãƒ£ãƒ³ãƒãƒ«ã‹ï¼Ÿ â†’ No: ç„¡è¦–
   - botæŠ•ç¨¿ã‹ï¼Ÿ â†’ Yes: ç„¡è¦–
   - thread_ts ã‚ã‚Šï¼Ÿ â†’ Yes: 4.2ã¸
3. Claude Code æ–°è¦å®Ÿè¡Œ
   claude -p "<ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸>" --output-format json
4. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ session_id æŠ½å‡º
5. sessions.json ã«ä¿å­˜
   key: message.ts (= thread_ts ã¨ã—ã¦æ‰±ã†)
6. Slack ã‚¹ãƒ¬ãƒƒãƒ‰ã«è¿”ä¿¡æ¡ˆã‚’æŠ•ç¨¿
```

### 4.2 ã‚¹ãƒ¬ãƒƒãƒ‰å†…è¿”ä¿¡

```
1. Slack message ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡
2. ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
   - å¯¾è±¡ãƒãƒ£ãƒ³ãƒãƒ«ã‹ï¼Ÿ â†’ No: ç„¡è¦–
   - botæŠ•ç¨¿ã‹ï¼Ÿ â†’ Yes: ç„¡è¦–
   - thread_ts ã‚ã‚Šï¼Ÿ â†’ No: 4.1ã¸
3. sessions.json ã‹ã‚‰ session_id å–å¾—
   - è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ: æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ã—ã¦æ‰±ã†
4. Claude Code å†é–‹å®Ÿè¡Œ
   claude -p "<ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸>" --resume <session_id> --output-format json
5. last_used_at ã‚’æ›´æ–°
6. Slack ã‚¹ãƒ¬ãƒƒãƒ‰ã«è¿”ä¿¡æ¡ˆã‚’æŠ•ç¨¿
```

## 5. Claude Code å®Ÿè¡Œè©³ç´°

### 5.1 æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³

```bash
claude -p "<user_message>" \
  --output-format json \
  --append-system-prompt "ã‚ãªãŸã¯Slackã§ã®è¿”ä¿¡æ¡ˆã‚’ç”Ÿæˆã™ã‚‹ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
æ—¥æœ¬èªã§å›ç­”ã—ã¦ãã ã•ã„ã€‚
æ§‹æˆ: çµè«– â†’ ç†ç”± â†’ æ¬¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
æ–­å®šã—ã™ããšã€ææ¡ˆå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚"
```

### 5.2 ã‚»ãƒƒã‚·ãƒ§ãƒ³å†é–‹

```bash
claude -p "<user_message>" \
  --resume "<session_id>" \
  --output-format json
```

### 5.3 session_id æŠ½å‡º

```javascript
const output = JSON.parse(stdout);
const sessionId = output.session_id;
const result = output.result;
```

## 6. SlackæŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```
è¿”ä¿¡æ¡ˆï¼ˆãƒ‰ãƒ©ãƒ•ãƒˆï¼‰ğŸ‘‡

<ClaudeãŒç”Ÿæˆã—ãŸãƒ†ã‚­ã‚¹ãƒˆ>
```

## 7. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

| ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ | å¯¾å¿œ |
|-----------|------|
| Claudeå®Ÿè¡Œã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | ãƒ­ã‚°è¨˜éŒ²ã€SlackæŠ•ç¨¿ã—ãªã„ |
| Claudeå®Ÿè¡Œã‚¨ãƒ©ãƒ¼ | ãƒ­ã‚°è¨˜éŒ²ã€SlackæŠ•ç¨¿ã—ãªã„ |
| session_id å–å¾—å¤±æ•— | æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ã—ã¦å†è©¦è¡Œ |
| SlackæŠ•ç¨¿å¤±æ•— | ãƒ­ã‚°è¨˜éŒ²ã€ãƒªãƒˆãƒ©ã‚¤ï¼ˆ1å›ï¼‰ |
| sessions.json èª­ã¿è¾¼ã¿å¤±æ•— | ç©ºã®çŠ¶æ…‹ã§åˆæœŸåŒ– |

## 8. è¨­å®šé …ç›®

```javascript
const config = {
  // Slack
  slackBotToken: process.env.SLACK_BOT_TOKEN,
  slackAppToken: process.env.SLACK_APP_TOKEN,  // Socket Modeç”¨
  targetChannelId: process.env.TARGET_CHANNEL_ID,

  // Claude
  claudeWorkingDir: process.env.CLAUDE_WORKING_DIR || process.cwd(),
  claudeTimeout: 120000,  // 2åˆ†

  // Sessions
  sessionsFilePath: './sessions.json',
};
```

## 9. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
slack-claude-bridge/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts           # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ slack-client.ts    # Slack Bot Client
â”‚   â”œâ”€â”€ session-manager.ts # Session Manager
â”‚   â”œâ”€â”€ claude-executor.ts # Claude Executor
â”‚   â””â”€â”€ config.ts          # è¨­å®š
â”œâ”€â”€ sessions.json          # ã‚»ãƒƒã‚·ãƒ§ãƒ³å¯¾å¿œè¡¨
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ .env                   # ç’°å¢ƒå¤‰æ•°
```

## 10. æŠ€è¡“é¸å®š

| é …ç›® | é¸å®š | ç†ç”± |
|------|------|------|
| è¨€èª | TypeScript | å‹å®‰å…¨ã€ã‚¨ãƒ©ãƒ¼æ¤œå‡º |
| Slack SDK | @slack/bolt | Socket Modeå¯¾å¿œã€å…¬å¼ |
| ãƒ—ãƒ­ã‚»ã‚¹å®Ÿè¡Œ | child_process.spawn | ã‚¹ãƒˆãƒªãƒ¼ãƒ å¯¾å¿œ |
| çŠ¶æ…‹ç®¡ç† | JSON file | ã‚·ãƒ³ãƒ—ãƒ«ã€è¦ä»¶ã«åˆè‡´ |
